import pandas as pd
import os
import shutil

# --- CONFIGURAÇÕES ---
ARQUIVO_CSV = '/content/emails.csv.zip'  # Caminho padrão no Colab
PASTA_SAIDA = '/content/dataset_real_emails'
LIMITE_ARQUIVOS = 5000  # Comece com 5.000 para testar rápido

print(f"--- Lendo {ARQUIVO_CSV} ---")

# Limpa a pasta se já existir (para não misturar testes)
if os.path.exists(PASTA_SAIDA):
    shutil.rmtree(PASTA_SAIDA)
os.makedirs(PASTA_SAIDA)

try:
    # Lê o CSV
    df = pd.read_csv(ARQUIVO_CSV, nrows=LIMITE_ARQUIVOS)
    print(f"Processando {len(df)} emails...")

    count = 0
    for index, row in df.iterrows():
        # Pega o conteúdo (ajuste 'message' se a coluna tiver outro nome)
        conteudo = str(row.get('message', row.get('text', row.iloc[0])))
        
        # Cria arquivo individual
        nome_arquivo = os.path.join(PASTA_SAIDA, f"email_{index}.txt")
        with open(nome_arquivo, 'w', encoding='utf-8') as f:
            f.write(conteudo)
        
        count += 1
        if count % 1000 == 0:
            print(f"{count} arquivos criados...")

    print(f"\nSucesso! {count} arquivos prontos em '{PASTA_SAIDA}'.")

except Exception as e:
    print(f"Erro: {e}")
    print("Verifique se você fez o upload do emails.csv na aba de arquivos à esquerda.")
